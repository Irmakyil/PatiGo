{% extends 'base.html' %}
{% block content %}
<div class="panel-section">
    <h1>Görev Ekle</h1>
    <div class="add-task-box">
        {% if messages %}
            <ul class="form-messages">
                {% for message in messages %}
                    <li class="{{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
        <form method="post" action="">
            {% csrf_token %}
            {% if edit_task %}
                <input type="hidden" name="task_id" value="{{ edit_task.id }}">
            {% endif %}
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Görev Başlığı</label>
                    <input type="text" id="name" name="name" placeholder="Görev başlığı giriniz" required value="{{ edit_task.name|default:'' }}">
                </div>
                <div class="form-group">
                    <label for="end_time">Görev Bitiş Süresi</label>
                    {% if edit_task %}
    <input type="datetime-local" id="end_time" name="end_time" required value="{{ edit_task.end_time|date:'Y-m-d\\TH:i' }}">
{% else %}
    <input type="datetime-local" id="end_time" name="end_time" required>
{% endif %}
                </div>
                <div class="form-group">
                    <label for="priority">Öncelik</label>
                    <select id="priority" name="priority" required>
                        <option value="acil" {% if edit_task and edit_task.priority == 'acil' %}selected{% endif %}>Acil</option>
                        <option value="orta" {% if edit_task and edit_task.priority == 'orta' %}selected{% endif %}>Orta Öncelik</option>
                        <option value="normal" {% if edit_task and edit_task.priority == 'normal' %}selected{% endif %}>Normal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="animal_count">Hayvan Sayısı</label>
                    <input type="number" id="animal_count" name="animal_count" min="1" placeholder="Hayvan" required value="{{ edit_task.animal_count|default:'' }}">
                </div>
                <div class="form-group">
                    <label for="status">Durum</label>
                    <textarea id="status" name="status" rows="2" placeholder="Durum">{{ edit_task.status|default:'' }}</textarea>
                </div>
            </div>
            <button type="submit" class="btn btn-main" style="width:100%;margin-top:1.2rem;">{% if edit_task %}Güncelle{% else %}Görev Ekle{% endif %}</button>
        </form>
    </div>
    <div class="tasks-list-section">
        <h2>Eklenen Görevler</h2>
        {% for task in tasks %}
        <div class="task-list-box">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <strong>{{ task.name }}</strong>
                <span>{{ task.end_time|date:'d.m.Y' }}</span>
            </div>
            <span>Hayvan Sayısı: {{ task.animal_count }}</span><br>
            <span>Görev Bitiş Süresi: {{ task.end_time|date:'d F, H:i' }}</span><br>
            <span>Durum: {{ task.status }}</span><br>
            <div style="margin-top:0.7rem;">
                <a href="?edit={{ task.id }}" class="btn btn-edit">Düzenle</a>
                <a href="?delete={{ task.id }}" class="btn btn-delete" onclick="return confirm('Görev silinsin mi?');">Sil</a>
            </div>
        </div>
        {% empty %}
        <p>Henüz görev eklenmedi.</p>
        {% endfor %}
    </div>
</div>
{% endblock %} 